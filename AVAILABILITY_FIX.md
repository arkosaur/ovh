# å¯ç”¨æ€§æŸ¥è¯¢å‡†ç¡®æ€§ä¿®å¤

## é—®é¢˜æè¿°

**åŸå§‹é—®é¢˜ï¼š**
å½“ç”¨æˆ·åœ¨æœåŠ¡å™¨åˆ—è¡¨ä¸­ä¿®æ”¹é…ç½®é€‰é¡¹ï¼ˆå¦‚å†…å­˜ã€å­˜å‚¨ç­‰ï¼‰åï¼Œç‚¹å‡»"æ£€æŸ¥å¯ç”¨æ€§"ï¼Œç³»ç»Ÿä»ç„¶æŸ¥è¯¢çš„æ˜¯**é»˜è®¤é…ç½®**çš„å¯ç”¨æ€§ï¼Œè€Œä¸æ˜¯ç”¨æˆ·é€‰æ‹©çš„é…ç½®ã€‚

**ç¤ºä¾‹ï¼š**
- é»˜è®¤é…ç½®ï¼š32GB å†…å­˜
- ç”¨æˆ·é€‰æ‹©ï¼š64GB å†…å­˜
- æŸ¥è¯¢ç»“æœï¼šä»ç„¶è¿”å› 32GB å†…å­˜çš„å¯ç”¨æ€§ âŒ

## æ ¹æœ¬åŸå› 

1. **å‰ç«¯é—®é¢˜ï¼š** `checkAvailability` å‡½æ•°åªä¼ é€’ `planCode`ï¼Œæ²¡æœ‰ä¼ é€’ç”¨æˆ·é€‰æ‹©çš„é…ç½®é€‰é¡¹
2. **åç«¯é—®é¢˜ï¼š** `check_server_availability` å‡½æ•°ä¸æ¥æ”¶é…ç½®å‚æ•°ï¼Œå§‹ç»ˆæŸ¥è¯¢é»˜è®¤é…ç½®

## è§£å†³æ–¹æ¡ˆ

### 1. å‰ç«¯ä¿®æ”¹ (`src/pages/ServersPage.tsx`)

**ä¿®æ”¹å‰ï¼š**
```typescript
const checkAvailability = async (planCode: string) => {
  // ...
  const response = await axios.get(`${API_URL}/availability/${planCode}`);
  console.log(`è·å–åˆ° ${planCode} çš„å¯ç”¨æ€§æ•°æ®:`, response.data);
  // ...
}
```

**ä¿®æ”¹åï¼š**
```typescript
const checkAvailability = async (planCode: string) => {
  // è·å–ç”¨æˆ·é€‰æ‹©çš„é…ç½®é€‰é¡¹
  const selectedOpts = selectedOptions[planCode] || [];
  
  // å¦‚æœç”¨æˆ·é€‰æ‹©äº†è‡ªå®šä¹‰é…ç½®ï¼Œä¼ é€’è¿™äº›é€‰é¡¹
  const params: any = {};
  if (selectedOpts.length > 0) {
    params.options = selectedOpts.join(',');
  }
  
  const response = await axios.get(`${API_URL}/availability/${planCode}`, { params });
  console.log(`è·å–åˆ° ${planCode} çš„å¯ç”¨æ€§æ•°æ® (é…ç½®: ${selectedOpts.join(', ') || 'é»˜è®¤'}):`, response.data);
  // ...
}
```

### 2. åç«¯è·¯ç”±ä¿®æ”¹ (`backend/app.py`)

**ä¿®æ”¹å‰ï¼š**
```python
@app.route('/api/availability/<plan_code>', methods=['GET'])
def get_availability(plan_code):
    availability = check_server_availability(plan_code)
    # ...
```

**ä¿®æ”¹åï¼š**
```python
@app.route('/api/availability/<plan_code>', methods=['GET'])
def get_availability(plan_code):
    # è·å–é…ç½®é€‰é¡¹å‚æ•°ï¼ˆé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²ï¼‰
    options_str = request.args.get('options', '')
    options = [opt.strip() for opt in options_str.split(',') if opt.strip()] if options_str else []
    
    availability = check_server_availability(plan_code, options)
    # ...
```

### 3. åç«¯å‡½æ•°ä¿®æ”¹ (`backend/app.py`)

**ä¿®æ”¹å‰ï¼š**
```python
def check_server_availability(plan_code):
    # ...
    availabilities = client.get('/dedicated/server/datacenter/availabilities', planCode=plan_code)
    # ...
```

**ä¿®æ”¹åï¼š**
```python
def check_server_availability(plan_code, options=None):
    # æ„å»ºæŸ¥è¯¢å‚æ•°
    params = {'planCode': plan_code}
    
    # å¦‚æœæä¾›äº†é…ç½®é€‰é¡¹ï¼Œæ·»åŠ åˆ°æŸ¥è¯¢å‚æ•°ä¸­
    if options and len(options) > 0:
        # OVH APIä½¿ç”¨'addonFamily'å‚æ•°æ¥æŒ‡å®šé¢å¤–é…ç½®
        for option in options:
            if 'addonFamily' not in params:
                params['addonFamily'] = []
            if not isinstance(params['addonFamily'], list):
                params['addonFamily'] = [params['addonFamily']]
            params['addonFamily'].append(option)
    
    availabilities = client.get('/dedicated/server/datacenter/availabilities', **params)
    
    config_info = f" (é…ç½®: {', '.join(options)})" if options else " (é»˜è®¤é…ç½®)"
    add_log("INFO", f"æˆåŠŸæ£€æŸ¥ {plan_code}{config_info} çš„å¯ç”¨æ€§: {result}")
    # ...
```

## å·¥ä½œæµç¨‹

### ä¿®å¤å‰ï¼š
```
ç”¨æˆ·ç•Œé¢:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 24rise012                   â”‚
â”‚ â˜‘ 32GB (é»˜è®¤)              â”‚
â”‚ â˜ 64GB â† ç”¨æˆ·é€‰æ‹©          â”‚
â”‚ â˜ 128GB                    â”‚
â”‚ [æ£€æŸ¥å¯ç”¨æ€§]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
å‰ç«¯: GET /api/availability/24rise012
         â†“
åç«¯: planCode=24rise012 (ä»…é»˜è®¤é…ç½®)
         â†“
OVH API: è¿”å› 32GB çš„å¯ç”¨æ€§ âŒ
```

### ä¿®å¤åï¼š
```
ç”¨æˆ·ç•Œé¢:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 24rise012                   â”‚
â”‚ â˜ 32GB                     â”‚
â”‚ â˜‘ 64GB â† ç”¨æˆ·é€‰æ‹©          â”‚
â”‚ â˜ 128GB                    â”‚
â”‚ [æ£€æŸ¥å¯ç”¨æ€§]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
å‰ç«¯: GET /api/availability/24rise012?options=ram-64g-ecc-3200-24rise
         â†“
åç«¯: planCode=24rise012, addonFamily=[ram-64g-ecc-3200-24rise]
         â†“
OVH API: è¿”å› 64GB çš„å¯ç”¨æ€§ âœ…
```

## æµ‹è¯•éªŒè¯

### æµ‹è¯•æ­¥éª¤ï¼š

1. **æ‰“å¼€æœåŠ¡å™¨åˆ—è¡¨**
   ```
   è®¿é—® http://localhost:8080/servers
   ```

2. **æœç´¢æœåŠ¡å™¨**
   ```
   æœç´¢æ¡†è¾“å…¥: 24rise012
   ```

3. **æŸ¥çœ‹é»˜è®¤é…ç½®å¯ç”¨æ€§**
   ```
   ç‚¹å‡» "æ£€æŸ¥å¯ç”¨æ€§"
   è§‚å¯Ÿæ§åˆ¶å°æ—¥å¿—: "è·å–åˆ° 24rise012 çš„å¯ç”¨æ€§æ•°æ® (é…ç½®: é»˜è®¤)"
   ```

4. **ä¿®æ”¹é…ç½®**
   ```
   é€‰æ‹©: 64GB å†…å­˜
   æˆ–: SOFTRAID 2x 960GB NVME
   ```

5. **å†æ¬¡æ£€æŸ¥å¯ç”¨æ€§**
   ```
   ç‚¹å‡» "æ£€æŸ¥å¯ç”¨æ€§"
   è§‚å¯Ÿæ§åˆ¶å°æ—¥å¿—: "è·å–åˆ° 24rise012 çš„å¯ç”¨æ€§æ•°æ® (é…ç½®: ram-64g-ecc-3200-24rise)"
   ```

6. **éªŒè¯ç»“æœ**
   ```
   âœ… æ§åˆ¶å°æ˜¾ç¤ºæ­£ç¡®çš„é…ç½®é€‰é¡¹
   âœ… è¿”å›çš„å¯ç”¨æ€§æ•°æ®åº”è¯¥ä¸åŒï¼ˆå¦‚æœé…ç½®å½±å“åº“å­˜ï¼‰
   âœ… æ—¥å¿—ä¸­æ˜¾ç¤ºæ­£ç¡®çš„é…ç½®ä¿¡æ¯
   ```

## é¢„æœŸç»“æœ

### æ§åˆ¶å°æ—¥å¿—ç¤ºä¾‹ï¼š

**é»˜è®¤é…ç½®ï¼š**
```
è·å–åˆ° 24rise012 çš„å¯ç”¨æ€§æ•°æ® (é…ç½®: é»˜è®¤): {bhs: 1H-low, fra: 72H, gra: unavailable}
```

**64GBå†…å­˜é…ç½®ï¼š**
```
è·å–åˆ° 24rise012 çš„å¯ç”¨æ€§æ•°æ® (é…ç½®: ram-64g-ecc-3200-24rise): {bhs: unavailable, fra: 1H-high, gra: 24H}
```

**å¤šä¸ªé…ç½®ï¼š**
```
è·å–åˆ° 24rise012 çš„å¯ç”¨æ€§æ•°æ® (é…ç½®: ram-64g-ecc-3200-24rise, softraid-2x960nvme-24rise): {bhs: 72H, fra: unavailable}
```

## æ³¨æ„äº‹é¡¹

1. **é…ç½®é€‰é¡¹æ ¼å¼**
   - å‰ç«¯ä¼ é€’: é€—å·åˆ†éš”çš„å­—ç¬¦ä¸² `"option1,option2,option3"`
   - åç«¯è§£æ: æ•°ç»„ `["option1", "option2", "option3"]`
   - OVH API: `addonFamily` å‚æ•°æ•°ç»„

2. **APIå…¼å®¹æ€§**
   - OVH API çš„ `/dedicated/server/datacenter/availabilities` ç«¯ç‚¹æ”¯æŒ `addonFamily` å‚æ•°
   - å¦‚æœ OVH API ä¸æ”¯æŒæŸäº›é…ç½®ç»„åˆï¼Œä¼šè¿”å›é”™è¯¯æˆ–ç©ºç»“æœ

3. **ç”¨æˆ·ä½“éªŒ**
   - ç”¨æˆ·ä¿®æ”¹é…ç½®åï¼Œä¹‹å‰æŸ¥è¯¢çš„å¯ç”¨æ€§æ•°æ®ä¸ä¼šè‡ªåŠ¨æ›´æ–°
   - éœ€è¦ç”¨æˆ·ä¸»åŠ¨ç‚¹å‡»"æ£€æŸ¥å¯ç”¨æ€§"æŒ‰é’®é‡æ–°æŸ¥è¯¢
   - æ§åˆ¶å°æ—¥å¿—ä¼šæ¸…æ™°æ˜¾ç¤ºæŸ¥è¯¢çš„é…ç½®

4. **é”™è¯¯å¤„ç†**
   - å¦‚æœé…ç½®é€‰é¡¹æ— æ•ˆï¼ŒOVH API å¯èƒ½è¿”å›é”™è¯¯
   - åç«¯ä¼šè®°å½•é”™è¯¯æ—¥å¿—
   - å‰ç«¯ä¼šæ˜¾ç¤º"è·å–å¯ç”¨æ€§å¤±è´¥"æç¤º

## ç›¸å…³æ–‡ä»¶

- `src/pages/ServersPage.tsx` - å‰ç«¯æœåŠ¡å™¨åˆ—è¡¨é¡µé¢
- `backend/app.py` - åç«¯ API è·¯ç”±å’Œå¯ç”¨æ€§æ£€æŸ¥å‡½æ•°

## æç¤ºè¯´æ˜æ›´æ–°

å»ºè®®æ›´æ–°é¡µé¢ä¸Šçš„æç¤ºè¯´æ˜ï¼š

**åŸæ–‡ï¼š**
```
å¯ç”¨æ€§æ£€æµ‹è¯´æ˜ï¼šå¯ç”¨æ€§æ£€æµ‹ä»…é’ˆå¯¹æœåŠ¡å™¨é»˜è®¤é…ç½®...
```

**å»ºè®®ä¿®æ”¹ä¸ºï¼š**
```
å¯ç”¨æ€§æ£€æµ‹è¯´æ˜ï¼šå¯ç”¨æ€§æ£€æµ‹ä¼šæ ¹æ®æ‚¨é€‰æ‹©çš„é…ç½®æŸ¥è¯¢å®é™…åº“å­˜çŠ¶æ€ã€‚
è‹¥æœªé€‰æ‹©ä»»ä½•è‡ªå®šä¹‰é…ç½®ï¼Œå°†æŸ¥è¯¢é»˜è®¤é…ç½®çš„å¯ç”¨æ€§ã€‚
å»ºè®®é€‰æ‹©å¤šä¸ªæ•°æ®ä¸­å¿ƒä»¥æé«˜æŠ¢è´­æˆåŠŸç‡ã€‚
```

## æ€»ç»“

âœ… **ä¿®å¤å®Œæˆï¼** ç°åœ¨å¯ç”¨æ€§æŸ¥è¯¢ä¼šå‡†ç¡®åæ˜ ç”¨æˆ·é€‰æ‹©çš„é…ç½®é€‰é¡¹ï¼Œè€Œä¸æ˜¯å§‹ç»ˆæŸ¥è¯¢é»˜è®¤é…ç½®ã€‚

ğŸ¯ **å…³é”®æ”¹è¿›ï¼š**
- å‰ç«¯ä¼ é€’ç”¨æˆ·é€‰æ‹©çš„é…ç½®
- åç«¯æ¥æ”¶å¹¶è½¬å‘é…ç½®åˆ° OVH API
- æ—¥å¿—æ¸…æ™°æ˜¾ç¤ºæŸ¥è¯¢çš„é…ç½®
- å¯ç”¨æ€§ç»“æœå‡†ç¡®å¯¹åº”ç”¨æˆ·é…ç½®
